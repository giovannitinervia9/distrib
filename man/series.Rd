% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/numerical_functions.R
\name{series}
\alias{series}
\title{Numerical Summation of Discrete Series}
\usage{
series(
  f,
  start = 0,
  end = Inf,
  step = 1000,
  tol = 1e-10,
  maxit = 1e+07,
  reltol = TRUE
)
}
\arguments{
\item{f}{A function taking a vector of integers \code{x} and returning a vector of numeric values.
\strong{Must be vectorized} (able to handle multiple inputs at once).}

\item{start}{Numeric. The starting value of the sequence. Can be finite, \code{Inf}, or \code{-Inf}.}

\item{end}{Numeric. The ending value of the sequence. Can be finite, \code{Inf}, or \code{-Inf}.
Defaults to \code{Inf}.}

\item{step}{Integer. The number of terms to calculate in a single vectorized batch.
Defaults to 10000.}

\item{tol}{Numeric. Tolerance threshold for convergence. Defaults to \code{1e-10}.}

\item{maxit}{Integer. Safety limit for the maximum number of batch iterations.
Defaults to 1000000.}

\item{reltol}{Logical. If \code{TRUE} (default), uses a \strong{hybrid relative tolerance} criterion:
\code{tol*max(abs(s), 1)}.  If \code{FALSE}, uses strict \strong{absolute tolerance} (\code{tol}).}
}
\value{
A numeric scalar representing the calculated sum.
}
\description{
Calculates the sum of a function \code{f(x)} over a sequence of integers from \code{start} to \code{end}.
The function is designed to handle finite sums, one-sided infinite series, and
doubly infinite series (from \code{-Inf} to \code{Inf}) by automatically adapting its summation strategy.
}
\details{
\strong{1. Summation Strategies:}
The function automatically detects the domain topology based on \code{start} and \code{end}:
\itemize{
\item \strong{Forward (Standard):} If \code{start <= end} (e.g., \code{1} to \code{Inf}), it sums \eqn{f(start) + f(start+1) + \dots} directly.
\item \strong{Backward (Reflection):} If \code{start > end} (e.g., \code{-1} to \code{-Inf}), it reflects the domain internally.
It calculates \eqn{\sum f(-x)} effectively iterating forward through the negative numbers.
\item \strong{Doubly Infinite (Folding):} If \code{start == -Inf} and \code{end == Inf}, it uses a "folding" strategy around zero.
It first calculates \eqn{f(0)}, then iterates \eqn{x} from 1 to \eqn{\infty}, summing
\eqn{f(x) + f(-x)} at each step.
}

\strong{2. Vectorization and Convergence:}
The summation is performed in blocks of size \code{step} to leverage R's vectorization capabilities.
For infinite bounds, the function checks for convergence based on the \code{reltol} parameter.

\strong{3. Underflow Protection:}
The function includes logic to prevent premature stopping if the series starts with a sequence
of zeros (e.g., a distribution centered far from the start). It continues searching until
a significant sum is accumulated (\code{s > tol}).
}
\examples{
# --- Case 1: Standard Convergent Series (Basel Problem) ---
# Sum of 1/x^2 from 1 to Inf => pi^2 / 6
f_basel <- function(x) 1 / x^2
series(f_basel, start = 1, end = Inf)

# --- Case 2: Expectation of Poisson (Large Mean) ---
d <- poisson_distrib()
theta <- list(mu = 10000)
f_mean <- function(x) x * d$pdf(x, theta)
series(f_mean, start = 0, end = Inf, reltol = TRUE)

}
